{% extends "_base.html" %}
{% block title %}
<%= modelName %> {{item.id}}
{% endblock %}
{% block content %}
<h1 class="entity"><%= modelName %> {{item.id}}</h1>
        <form action="/<%= modelName %>/{{item.id}}" method="post">
            <% for(const field in model) { %>
            <% if (field == 'createdAt' || field == 'updatedAt') continue; %>

            <div class="form-group">
                <% if (!model[field].primaryKey || model[field].foreignKey.target_table) { %>
                <label for="<%= field %>"><%= field %></label>
                <% } %>
    
                <% if (model[field].foreignKey && model[field].foreignKey.target_table) { %>
                <select name="<%= field %>" id="<%= field %>" value="{{item.<%= field %>}}" class="custom-select">
                    {% for opt in <%= model[field].foreignKey.target_table %> %}
                    <option value="{{opt.<%= model[field].foreignKey.target_column %>}}" {% if (item.<%= field %>==opt.<%= model[field].foreignKey.target_column %>) %}selected{% endif %}>{{opt | smart}}</option>
                    {% endfor %}
                </select>
                <% } else if (model[field].primaryKey) { %>
                    {% if item.<%= field %> %}
                    <input type="hidden" name="<%= field %>" value="{{item.<%= field %>}}">
                    {% endif %}
                <% } else if (model[field].type == 'DATETIME') { %>
                <input type="datetime-local" class="form-control" name="<%= field %>" id="<%= field %>" value="{{item.<%= field %>|dateformat('YYYY-MM-DD HH:mm:ss')}}">
                <% } else if (model[field].type == 'DATE') { %>
                <input type="date" class="form-control" name="<%= field %>" id="<%= field %>" value="{{item.<%= field %>|dateformat('YYYY-MM-DD')}}">
                <% } else if (model[field].type == 'TIME') { %>
                <input type="time" class="form-control" name="<%= field %>" id="<%= field %>" value="{{item.<%= field %>|dateformat('HH:mm:ss')}}">        
                <% } else if (model[field].type.startsWith('ENUM')) { %>
                    <% let opts = [...model[field].type.matchAll(/'([^']+)'/g)] %>
                    <% for (let i in opts) { %>
                        <input type="radio" name="<%= field %>" id="<%= field %>-<%= i %>" value="<%= opts[i][1] %>" {% if (item.<%= field %>=='<%= opts[i][1] %>') %}checked{% endif %}>
                        <label for="<%= field %>-<%= i %>"><%= opts[i][1] %></label>
                    <% } %>
                <% } else if (model[field].type.startsWith('INT')) { %>
                <input type="number" class="form-control" name="<%= field %>" id="<%= field %>" value="{{item.<%= field %>}}">
                <% } else { %>
                <input type="text" class="form-control" name="<%= field %>" id="<%= field %>" value="{{item.<%= field %>}}">
                <% } %>
            </div>
            <% } %>
            <div class="form-group">
                {% if item.id %}
                <input type="submit" value="Update" class="btn btn-primary">
                {% else %}
                <input type="submit" value="Create" class="btn btn-success">
                {% endif %}
            </div>
        </form>
{% endblock %}